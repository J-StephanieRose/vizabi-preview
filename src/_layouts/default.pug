block variables
  - var control_buttons = { play: true, languages: ["en", "se"], record: true }
  - var control_buttons = {play: true, language: true, record: true }
  - var title = "Preview"
  - var description = "This page previews Vizabi"
  - var tool = false
  - var tool_config = false
  - var source_code = "https://github.com/Gapminder/vizabi/tree/develop/src/tools/"
  - var chart_buttons = "[]"
  - var chart_buttons_expand = "[]"

doctype html
html(lang='en')
  head
    meta(charset='UTF-8')
    meta(content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0', name='viewport')

    title Vizabi - #{title}

    //- Styles
    link(rel='stylesheet', href='/assets/vendor/css/font-awesome.min.css')
    link(rel='stylesheet', href='/assets/css/main.css')
    link(rel='stylesheet', href='/vizabi/dist/vizabi.css')
  body
    #vzbp-main
      include ../_partials/nav.pug
      #vzbp-placeholder.vzbp-viewer

    #vzbp-sidebar
      include ../_partials/sidebar.pug

    include ../_partials/state_editor.pug

    div#vizabi-assets
    div#tool-assets

    script(src='/assets/vendor/js/d3/d3.js')
    script(src='/assets/vendor/js/vizabi-ws-reader/bundle.web.js')
    script(src='/assets/vendor/js/vizabi-ddfcsv-reader/vizabi-ddfcsv-reader.js')
    script.
      function load(container, branch, placeholder, scriptUrls) {
        scriptUrls.forEach(function(url) {
          var link = '/' + placeholder + '/' + branch + '/' + url;
          var elem;
          
          if (url.slice(-3) === '.js') {
            elem = document.createElement('script');
            elem.setAttribute('src', link);
          } else if (url.slice(-4) === '.css') {
            elem = document.createElement('link');
            elem.setAttribute('rel', 'stylesheet');
            elem.setAttribute('href', link);
          }

          elem && container.appendChild(elem);
        });
      }

      if (!~window.location.origin.indexOf('localhost')) {
        var url = new URLSearchParams(window.location.search);

        load(
          document.getElementById('vizabi-assets'),
          url.get('vizabi') || 'develop',
          'vizabi',
          [
            'dist/vizabi.js'
          ]
        );
        
        var tool = window.location.pathname.split('.')[0].slice(1);
        console.log(tool);
        load(
          document.getElementById('tool-assets'),
          url.get('tool') || 'master',
          'vizabi-' + tool,
          [
            'dist/' + tool + '.js',
            'dist/' + tool + '.css'
          ]
        );
      }

    script(src='/vizabi/dist/vizabi.js')
    script(src='/assets/js/_utils.js')
    script(src='/assets/js/_collapsible.js')
    script(src='/assets/js/_url.js')
    script(src='/assets/js/_codepen.js')
    script(src='/assets/js/main.js')
    script(src='/assets/js/_state-editor.js')
    script(src='/assets/js/_size-div.js')
    script(src='/assets/js/_interaction.js')
    script(src='/assets/js/_dropdowns.js')

    unless !tool
      include ../_partials/toolscript.pug
